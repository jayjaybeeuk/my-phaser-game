# Maniacal Miner - AI Assistant Context

## Project Overview
A modern recreation of the classic Manic Miner platformer game, built with Phaser.js and TypeScript. This is a retro-style platformer with air depletion mechanics, collectibles, moving enemies, and multiple levels.

## Tech Stack
- **Game Engine**: Phaser.js v3.88.2
- **Language**: TypeScript (ES6, strict mode)
- **Build Tool**: Webpack 5
- **Desktop**: Electron v28
- **Node Version**: 24.11.1 (see `.nvmrc`)

## Project Structure
```
my-phaser-game/
├── src/
│   ├── scenes/          # Game scenes (Menu, Game, GameOver, etc.)
│   ├── objects/         # Game objects (Player, Enemy, etc.)
│   ├── systems/         # Game systems (collision, input, etc.)
│   ├── levels/          # Level management and data
│   ├── assets/          # Asset management
│   ├── constants/       # Game constants and configuration
│   ├── utils/           # Utility functions
│   └── index.ts         # Entry point
├── assets/              # Game assets (sprites, audio, level data)
├── build/               # Electron build resources (icons)
├── design/              # Design documents and planning
├── dist/                # Webpack build output
├── release/             # Electron build output
├── electron.js          # Electron main process
├── index.html           # Web entry point
└── webpack.config.js    # Webpack configuration
```

## Key Features
- Classic Manic Miner gameplay mechanics
- Three unique levels: Central Cavern, Underground Chamber, Arctic Zone
- Air depletion system with strategic air capsule placements
- Collectible items and scoring
- Four distinct animated enemy types with unique movement patterns
- Lives and high score system with localStorage persistence
- Smooth sprite animations
- Audio integration (web only - disabled in Electron due to file protocol limitations)
- Debug menu (F1) for development
- Gamepad/controller support with automatic detection
- Cross-platform: Web (Vercel) and Desktop (Electron)

## Enemy System
Four distinct animated enemy types with unique movement patterns:
- **Spider**: Ground-based patrol enemy
- **Bat/Bird**: Flying enemy with aerial patrol routes
- **Crab**: Horizontal movement enemy
- **Cyan Blob**: Bouncing/floating enemy

## Biome System
Levels use a biome system that defines visual and physical characteristics:

**Available Biomes:**
- **Cavern**: Standard dark caves (default)
- **Underground**: Deep chambers with drip particles and dim lighting
- **Arctic**: Ice physics, snow particles, slippery surfaces (friction: 0.3)
- **Lava**: Volcanic with ember particles, fast air depletion, sticky surfaces
- **Forest**: Mushroom forest with spores, lower gravity, mossy (slightly slippery)
- **Crystal**: Magical caves with sparkles, lower gravity, faster movement
- **Toxic**: Hazardous waste with bubbles, very fast air depletion, slippery sludge

**Biome Properties:**
- `visuals`: Background color, brick texture, particles, fog, UI accent color
- `physics`: Friction, gravity, air depletion rate, player speed multiplier
- `audio`: Ambient sounds, custom music tracks

**Usage:** Set `biome: BiomeType.ARCTIC` in LevelConfig, or use legacy `backgroundColor`/`brickTexture` properties.

## Level-Specific Mechanics
- **Central Cavern** (Cavern biome): Standard platforming mechanics, introduction to core gameplay
- **Underground Chamber** (Underground biome): Classic hazard navigation with drip particles
- **Arctic Zone** (Arctic biome): Ice physics with momentum-based sliding - player builds speed and slides on icy platforms

## Key Classes
- `PlayerController` - Player movement, physics, and state management
- `EnemyManager` - Enemy spawning and behavior coordination
- `AssetManager` - Centralized asset loading and caching
- `LevelManager` - Level data, progression, and biome application
- `BiomeManager` - Biome definitions, effects (particles, fog), and physics properties
- `CollisionSystem` - Collision detection and response

## Data Persistence
- High scores stored in localStorage
- Settings persistence for audio/controls preferences

## Development Commands
```bash
npm run dev              # Start webpack dev server (http://localhost:8080)
npm run build            # Production build for web
npm run electron         # Run Electron app
npm run electron:dev     # Run Electron in development mode
npm run electron:build:mac    # Build Mac desktop app
npm run electron:build:win    # Build Windows desktop app
npm run electron:build:linux  # Build Linux desktop app
```

## Code Style & Conventions
- **TypeScript**: Strict mode enabled, ES6 target
- **Naming**: PascalCase for classes, camelCase for variables/functions
- **Architecture**: Scene-based architecture with managers for assets and levels
- **File Organization**: Group by feature/type (scenes, objects, systems)

## Important Notes
1. **Audio Limitation**: Audio is disabled in Electron builds due to file protocol issues. Web version has full audio support.
2. **Asset Loading**: Assets are loaded through AssetManager for centralized management
3. **Level System**: Levels are managed by LevelManager with JSON data files
4. **Controls**: Support for keyboard (Arrow keys/WASD) and gamepad input
5. **Debug Features**: Debug menu available in development builds (level skip, collision debug, unlimited lives)

## Common Tasks
- **Adding a new level**: Update LevelManager, set `biome` property in LevelConfig
- **Adding a new biome**: Add to `BiomeType` enum and `BIOME_DEFINITIONS` in BiomeManager.ts
- **Adding sprites**: Place in `assets/` and register in AssetManager
- **Adding biome textures**: Create brick-{biome}.png, add to AssetManager, register in BiomeManager
- **Modifying game mechanics**: Check GameScene.ts and relevant systems
- **Fixing TypeScript errors**: Check type definitions, especially for Phaser plugins
- **Building for desktop**: Ensure assets are properly bundled in webpack config

## Known Issues
- Gamepad plugin requires proper initialization (use `this.input.gamepad.once('connected', ...)` pattern)
- Audio doesn't work in Electron builds (file:// protocol limitation)
- TypeScript strict mode may require explicit typing for Phaser objects

## Testing
- Manual testing via dev server for web version
- Test Electron builds separately as they have different constraints
- Verify gamepad support with physical controller
- Check all three levels for progression and mechanics

## Deployment
- **Web**: Deployed on Vercel (see `vercel.json`)
- **Desktop**: Built with electron-builder to `release/` directory

## Asset Creation
Custom pixel-art sprites created using HTML5 Canvas-based generators to match the classic Manic Miner aesthetic. Sprite sheets require precise frame dimension calculations for proper animation.

## When Helping
- Maintain TypeScript strict mode compliance
- Follow existing architecture patterns (scenes, managers, systems)
- Consider both web and Electron compatibility
- Test changes in dev server before suggesting production builds
- Preserve retro game feel while using modern code practices
- Reference Phaser 3 documentation for API usage
